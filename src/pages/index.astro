---
import BaseLayout from "~/components/layouts/BaseLayout.astro";
import { PartFrontmatter } from "~/components/layouts/PartLayout.astro";
import "~/styles/index.css";

const pages = await Astro.glob<PartFrontmatter>("./**/index.md");

let chapterIndex = 1;

const parts = pages
  .filter((page) => page.url.split("/").length === 2)
  .map((part) => ({
    ...part,
    chapters: pages
      .filter((page) => page.url.startsWith(part.url) && page.url !== part.url)
      .map((chapter) => ({
        ...chapter,
        index: chapterIndex++,
      })),
  }));
---

<BaseLayout>
  <main class="max-w-screen-md mx-auto p-2 md:p-8">
    <h1 class="text-4xl font-bold">Aligning AI</h1>
    <hr class="my-4" />
    <div class="flex flex-col gap-4">
      {
        parts.map((part, partIndex) => (
          <section class="py-2">
            <h2 class="text-xl font-bold pb-2">
              {!!partIndex && `Part ${partIndex}.`} {part.frontmatter.title}
            </h2>
            {part.chapters.map((chapter) => (
              <a href={chapter.url} class="block py-1 text-md font-bold">
                <div class="inline-block w-6">{chapter.index}</div>
                {chapter.frontmatter.title}
              </a>
            ))}
          </section>
        ))
      }
    </div>
  </main>
</BaseLayout>
